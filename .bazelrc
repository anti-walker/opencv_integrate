build:arm_base --incompatible_enable_cc_toolchain_resolution=true

build:base --cxxopt='-std=c++17'
build:base --host_cxxopt='-std=c++17'
build:base --copt=-fPIC
build:base --cxxopt=-fPIC
build:base --cxxopt=-fdiagnostics-color=always

build:arm --config=base
build:arm --config=arm_base
build:arm --platforms=//bazel/platforms:aarch64_linux
build:x86  --config=base
build:x86  --platforms=//bazel/platforms:x86_64_linux

build:debug --copt=-fsanitize=address
build:debug --linkopt=-fsanitize=address
build:debug --cxxopt=-g
build:debug --copt="-O0"
build:debug --strip=never

build:x86_debug --config=x86
build:x86_debug --config=debug
build:x86_debug --linkopt=-lunwind --linkopt=-lunwind-x86_64

build:arm_debug --config=arm
build:arm_debug --config=debug

# build --action_env=CYBER_PATH=./cyber

# +------------------------------------------------------------+
# | CPP Lint Tests & Unit Tests                                |
# +------------------------------------------------------------+
# By default, cpplint tests are run as part of `bazel test` alongside all of
# the other compilation and test targets.  This is a convenience shortcut to
# only do the cpplint testing and nothing else.
# Do bazel test --config=cpplint <target> to enable this configuration.
# To enable the lint test, the BUILD *must* load the cpplint.bzl by having
# 'load("//tools:cpplint.bzl", "cpplint")' at the beginning and 'cpplint()'
# at the end.

test --action_env=LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH
test --test_env=LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH

test --action_env=CYBER_PATH=./cyber
test --test_env=CYBER_PATH=./cyber

test --test_strategy=exclusive
test --test_timeout=20000
test --flaky_test_attempts=1

# Regular unit tests.
test --test_tag_filters=-cpplint
test --nocache_test_results

# Coverage tests
coverage --test_tag_filters=-cpplint

